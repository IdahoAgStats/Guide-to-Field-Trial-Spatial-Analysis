# Introduction {#intro}

## Why care about spatial variation?



Goal in this case is to understand and account for spatial variation. These are lattice data

## Diagnosing spatial autocorrelation

Spatial correlation is similarity of plots that are close to one another. Larger spatial gradients need to modelled indpendently - perhaps through blocking. 

### Moran's I

Moran's I is similar like a correlation coefficient. It is a test for correation between units (plots in our case). There are many options for defining adjacent neighbors and how to weight each neighbors's influence. 

There are two common configuations for defininig neighbor's: the rook and queen configurations. These are exctly what their chess analogy suggest: "rook" defines neighbhors in an row/column fashion, while "queen" defines nieghbors in a row/column configuation an also neighbors located diagonally at a 45 degree angle from the row/column neighbors. Determining this can be complicated when working with irregularly-placed data (e.g. county seats), but is quite unambiguous for gridded data commonly seen in panned field experiments:

```{r echo=FALSE}
library(ggplot2)

na <- "Not adjacent"
o <- "Observation of interest"
n <- "Adjacent neighbor"

sp.config <- data.frame(row = rep(1:5, 5), 
                        column = rep(1:5, each = 5),
                        rook = c(rep(na, 5),
                                 na, na, n, na, na,
                                 na, n, o, n, na,
                                 na, na, n, na, na,
                                 rep(na, 5)),
                        queen = c(rep(na, 5),
                                 na, n, n, n, na,
                                 na, n, o, n, na,
                                 na, n, n, n, na,
                                 rep(na, 5)))

ggplot(sp.config, aes(x = row, y = column)) +
  geom_tile(aes(fill = rook), col = "black") +
  scale_fill_manual(values = c("yellow", "white", "red")) + 
  guides(fill = F) + 
  theme_void() + 
  coord_fixed() + 
  ggtitle("Rook")
  
ggplot(sp.config, aes(x = row, y = column)) +
  geom_tile(aes(fill = queen), col = "black") + 
  scale_fill_manual(values = c("yellow", "white", "red")) +   
  theme_void() +
  coord_fixed() + 
  ggtitle("Queen")  
```




### Empirical variogram & semivariance

An empirical varigram is a visual tool for understanding how error terms are related to each other over spatial distanc. It relies on semivariance ($\gamma$), a statistic expressing variance as a function of pairwise distances between data points.   

$$\gamma(h) = \frac{1}{2|N(h)|}\sum_{N(h)}(x_i - x_j)^2$$

Semivariances are binned for distance intervals. The average values for semivariance and distance interval can be fit to correlated error models such a exponential, spherical, gaussian and MatÃ©r. How to dothis is explored further in section 2 of this guide. 

Three important concepts of an empirical variogram are *nugget*, *sill* and  *range* 

![Example Empirical Variogram](img/Sadoti2014_spherical.jpg)

* range
* sill 
* nugget

2 other concepts: 

* partial sill
* nugget effect


#### OLD STUFF

You can label chapter and section titles using `{#label}` after them, e.g., we can reference Chapter \@ref(intro). If you do not manually label them, there will be automatic labels anyway, e.g., Chapter \@ref(methods).

Figures and tables with captions will be placed in `figure` and `table` environments, respectively.

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Reference a figure by its code chunk label with the `fig:` prefix, e.g., see Figure \@ref(fig:nice-fig). Similarly, you can reference tables generated from `knitr::kable()`, e.g., see Table \@ref(tab:nice-tab).

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(iris, 20), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

You can write citations, too. For example, we are using the **bookdown** package [@R-bookdown] in this sample book, which was built on top of R Markdown and **knitr** [@xie2015].
